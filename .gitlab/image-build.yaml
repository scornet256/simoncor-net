---

variables:
  STORAGE_DRIVER: "overlay"

stages:
  - "build"

image-build:
  stage: "image-build"
  image: "quay.io/buildah/stable:latest"
  script:

    # login
    - "echo $CR_PASSWORD | docker login $CR_HOSTNAME -u $CR_USERNAME --password-stdin"

    # build image
    - "buildah bud -t simoncor-net -f Dockerfile.linux.amd64 ."

    # tag image
    - "buildah tag simoncor-net cr.simoncor.net/siempie/simoncor-net:latest"

    # push image
    - "buildah push cr.simoncor.net/siempie/simoncor-net:latest"

    # logout
    - "buildah logout $CR_HOSTNAME"
