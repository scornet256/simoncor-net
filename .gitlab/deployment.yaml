---
# deploy container on kubernetes
deployment:
  stage: "deployment"
  image:
    name: "bitnami/kubectl:latest"
    entrypoint: [""]
  rules:

    # run only on push to default branch
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH'
    - when: "never"

  before_script:
    - |
        # setup kubeconfig
        echo "$BUZZ_KUBECONFIG" > /tmp/kubeconfig
        export KUBECONFIG=/tmp/kubeconfig
        
        # verify connection
        kubectl cluster-info

  # deployment commands
  script:
    - |
        # deploy directly to cluster
        kubectl rollout restart deployment simoncor-net -n simoncor-net
