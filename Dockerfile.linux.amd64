# build stage
FROM registry.gitlab.simoncor.net/oci/hugo:latest AS hugo

# copy site content to /src
COPY . /src

# build the hugo site
RUN hugo --source=/src/

# production stage
FROM docker.io/joseluisq/static-web-server:2.40.1

# copy built site from builder stage
COPY --from=hugo /src/public /site/

# use port 3000
EXPOSE 3000

# run static web server
CMD ["--host=0.0.0.0", "--log-level=info", "--port=3000", "--root=/site/"]
